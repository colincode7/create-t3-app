---
title: Vari√°veis de Ambiente
description: Getting started with Create T3 App
layout: ../../../layouts/docs.astro
lang: pt
isMdx: true
---

import Callout from "../../../components/docs/callout.tsx";

O Create T3 App usa [Zod](https://github.com/colinhacks/zod) para validar suas vari√°veis de ambiente em runtime _e_ buildtime fornecendo alguns arquivos adicionais no diret√≥rio `env`:

## env.mjs

_Muito longo, n√£o li; Se voc√™ quiser adicionar uma nova vari√°vel de ambiente, voc√™ deve adicion√°-la tanto ao seu `.env` quanto definir o validador em `src/env.mjs`._

Este arquivo √© dividido em duas partes - o esquema e a desestrutura√ß√£o do objeto, bem como a l√≥gica de valida√ß√£o. A l√≥gica de valida√ß√£o n√£o deve ser tocada.

```ts:env.mjs
const server = z.object({
  NODE_ENV: z.enum(["development", "test", "production"]),
});

const client = z.object({
  // NEXT_PUBLIC_CLIENTVAR: z.string(),
});

const processEnv = {
  NODE_ENV: process.env.NODE_ENV,
  // NEXT_PUBLIC_CLIENTVAR: process.env.NEXT_PUBLIC_CLIENTVAR,
};
```

### Schema do Servidor

Defina seu esquema de vari√°veis de ambiente do lado do servidor aqui.

<Callout type="warning">
  Tenha certeza de n√£o prefixar as chaves aqui com `NEXT_PUBLIC` para n√£o expor
  segredos importantes ao cliente.
</Callout>

### Schema do Cliente

Defina seu esquema de vari√°veis de ambiente do lado do cliente aqui.

Para exp√¥-los ao cliente, voc√™ precisa prefix√°-los com `NEXT_PUBLIC`. A valida√ß√£o falhar√° se voc√™ n√£o o ajudar a detectar uma configura√ß√£o inv√°lida.

### Objeto processEnv

Desestruture o `process.env` aqui.

Precisamos de um objeto JavaScript com o qual possamos analisar nossos esquemas Zod e devido √† maneira como o Next.js lida com as vari√°veis de ambiente, voc√™ n√£o pode destruir `process.env` como um objeto normal, ent√£o precisamos fazer isso manualmente.

O TypeScript ajudar√° voc√™ a garantir que inseriu as chaves em `clientEnv` e tamb√©m em `clientSchema`.

```ts
// ‚ùå Isso n√£o funciona, precisamos desestrutur√°-lo manualmente
const schema = z.object({
  NEXT_PUBLIC_WS_KEY: z.string(),
});

const validated = schema.parse(process.env);
```

### L√≥gica de Valida√ß√£o

_Para o leitor interessado:_

<details>
<summary>Avan√ßado: L√≥gica de valida√ß√£o</summary>

Dependendo do ambiente (servidor ou cliente), validamos tanto o esquema do servidor quanto o do cliente. Isso significa que, mesmo que as vari√°veis de ambiente do servidor sejam indefinidas, elas n√£o acionar√£o a falha da valida√ß√£o - o que significa que podemos ter um √∫nico ponto de entrada para nossas vari√°veis de ambiente.

```ts
// src/env.mjs

const isServer = typeof window === "undefined";

const merged = server.merge(client);
const parsed = isServer
  ? merged.safeParse(processEnv) // <-- no server, valide tudo
  : client.safeParse(processEnv); // <-- no client, valide apenas o cliente

if (parsed.success === false) {
  console.error(
    "‚ùå Invalid environment variables:\n",
    ...formatErrors(parsed.error.format()),
  );
  throw new Error("Invalid environment variables");
}
```

Ent√£o, usamos um objeto proxy para lan√ßar erros se voc√™ tentar acessar uma vari√°vel de ambiente do lado do servidor no cliente.

```ts
// src/env.mjs

// proxy permite reatribuir os getters
export const env = new Proxy(parsed.data, {
  get(target, prop) {
    if (typeof prop !== "string") return undefined;
    // no client, permitimos apenas vari√°veis NEXT_PUBLIC_
    if (!isServer && !prop.startsWith("NEXT_PUBLIC_"))
      throw new Error(
        "‚ùå Attempted to access serverside environment variable on the client",
      );
    return target[prop]; // <-- otherwise, return the value
  },
});
```

</details>

## Usando Vari√°veis Ambiente

Quando voc√™ quiser usar suas vari√°veis de ambiente, voc√™ pode import√°-las de `env.mjs` e us√°-las como faria normalmente. Se voc√™ importar isso no cliente e tentar acessar uma vari√°vel de ambiente do lado do servidor, receber√° um erro em tempo de execu√ß√£o.

```ts:pages/api/hello.ts
import { env } from "../../env.mjs";

// `env` √© totalmente tipado e fornece autocomplete
const dbUrl = env.DATABASE_URL;
```

```ts:pages/index.tsx
import { env } from "../env.mjs";

// ‚ùå Isso lan√ßar√° um erro em tempo de execu√ß√£o
const dbUrl = env.DATABASE_URL;

// ‚úÖ Isso est√° correto
const wsKey = env.NEXT_PUBLIC_WS_KEY;
```

## .env.example

Como o arquivo `.env` padr√£o n√£o est√° comprometido com o controle de vers√£o, tamb√©m inclu√≠mos um arquivo `.env.example`, no qual voc√™ pode, opcionalmente, manter uma c√≥pia de seu arquivo `.env` com quaisquer segredos removidos. Isso n√£o √© necess√°rio, mas recomendamos manter o exemplo atualizado para tornar mais f√°cil para os contribuidores come√ßarem a usar seu ambiente.

Alguns frameworks e outras ferramentas, como o Next.js, sugerem que voc√™ armazene vari√°veis em um arquivo `.env.local` e fa√ßa commit de arquivos `.env` em seu projeto. Isso n√£o √© recomendado, pois poderia facilitar o acidente de incluir vari√°veis ambiente secretas em seu hist√≥rico do git. Em vez disso, recomendamos que voc√™ armazene essas vari√°veis no arquivo `.env`, mantenha o arquivo `.env` em seu `.gitignore` e fa√ßa commit somente de arquivos `.env.example` em seu projeto.

## Adicionando Vari√°veis Ambiente

Para garantir que sua compila√ß√£o nunca seja conclu√≠da sem as vari√°veis de ambiente de que o projeto precisa, voc√™ precisar√° adicionar novas vari√°veis de ambiente em **dois** locais:

üìÑ `.env`: Insira sua vari√°vel de ambiente como faria normalmente em um arquivo `.env`, ou seja, `CHAVE=VALOR`

üìÑ `schema.mjs`: Adicione a l√≥gica de valida√ß√£o apropriada para a vari√°vel de ambiente definindo um esquema Zod, por exemplo `TECLA: z.string()`

Opcionalmente, voc√™ tamb√©m pode manter `.env.example` atualizado:

üìÑ `.env.example`: Insira sua vari√°vel de ambiente, mas certifique-se de n√£o incluir o valor se for secreto, ou seja, `CHAVE=VALOR` ou `CHAVE=`

### Exemplo

_Quero adicionar meu token de API do Twitter como uma vari√°vel de ambiente do lado do servidor_

1. Adicione a vari√°vel de ambiente a `.env`:

```
TWITTER_API_TOKEN=1234567890
```

2. Adicione a vari√°vel de ambiente a `schema.mjs`:

```ts
export const serverSchema = z.object({
  // ...
  TWITTER_API_TOKEN: z.string(),
});

export const serverEnv = {
  // ...
  TWITTER_API_TOKEN: process.env.TWITTER_API_TOKEN,
};
```

<Callout type="info">
  Uma string vazia ainda √© uma string, ent√£o `z.string()` aceitar√° uma string
  vazia como um valor v√°lido. Se voc√™ quiser ter certeza de que a vari√°vel de
  ambiente n√£o est√° vazia, voc√™ pode usar `z.string().min(1)`.
</Callout>

3. opcional: adicione a vari√°vel de ambiente a `.env.example`, mas n√£o inclua o token

```
TWITTER_API_TOKEN=
```
